# ============================================================
# Markforged Onyx One — Macros
# Board-agnostic — works with any controller
# ============================================================

[gcode_macro START_PRINT]
description: Start print routine — heat, home, purge
gcode:
    {% set HOTEND_TEMP = params.HOTEND_TEMP|default(275)|int %}
    G90
    M82
    M104 S{HOTEND_TEMP}
    G28
    G0 X5 Y5 Z5 F3000
    M109 S{HOTEND_TEMP}
    G0 Z0.3 F300
    G92 E0
    G1 X80 E15 F1000
    G1 X85 F3000
    G92 E0

[gcode_macro END_PRINT]
description: End print — cool down, present part
gcode:
    M400
    G92 E0
    G1 E-2 F2400
    G91
    G0 Z10 F300
    G90
    G0 X0 Y130 F3000
    M104 S0
    M106 S0
    M84

[gcode_macro CANCEL_PRINT]
description: Cancel the running print
rename_existing: BASE_CANCEL_PRINT
gcode:
    END_PRINT
    BASE_CANCEL_PRINT

[gcode_macro PAUSE]
description: Pause the running print
rename_existing: BASE_PAUSE
gcode:
    {% set E = params.E|default(2)|float %}
    G91
    G1 E-{E} F2100
    G90
    BASE_PAUSE
    G0 X5 Y130 F3000

[gcode_macro RESUME]
description: Resume the paused print
rename_existing: BASE_RESUME
gcode:
    {% set E = params.E|default(2)|float %}
    G91
    G1 E{E} F2100
    G90
    BASE_RESUME

[gcode_macro M600]
description: Filament change
gcode:
    PAUSE
    {action_respond_info("Filament change — swap filament and RESUME")}
